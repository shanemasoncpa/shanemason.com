---
import BaseLayout from './BaseLayout.astro';

interface Props {
  title: string;
  description?: string;
  pubDate: Date;
  updatedDate?: Date;
  heroImage?: string;
  tags?: string[];
}

const { title, description, pubDate, updatedDate, heroImage, tags = [] } = Astro.props;

const formattedDate = pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

// Calculate reading time (rough estimate)
const content = await Astro.slots.render('default');
const wordCount = content.split(/\s+/).length;
const readingTime = Math.ceil(wordCount / 200);
---

<BaseLayout title={`${title} | Blog`} description={description}>
  <article class="section-padding">
    <div class="container-narrow">
      <!-- Header -->
      <header class="mb-12 animate-fade-in">
        <div class="flex items-center gap-4 text-sm text-primary-500 mb-4">
          <time datetime={pubDate.toISOString()}>{formattedDate}</time>
          <span>·</span>
          <span>{readingTime} min read</span>
        </div>
        
        <h1 class="text-4xl md:text-5xl lg:text-6xl mb-6">{title}</h1>
        
        {description && (
          <p class="text-xl text-primary-600 leading-relaxed">{description}</p>
        )}
        
        {tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mt-6">
            {tags.map(tag => (
              <span class="px-3 py-1 text-sm bg-primary-100 text-primary-700 rounded-full">
                {tag}
              </span>
            ))}
          </div>
        )}
      </header>
      
      <!-- Hero Image -->
      {heroImage && (
        <figure class="mb-12 -mx-6 md:-mx-8 lg:-mx-16 animate-fade-in stagger-1">
          <img 
            src={heroImage} 
            alt={title}
            class="w-full h-auto rounded-sm"
          />
        </figure>
      )}
      
      <!-- Content -->
      <div class="prose prose-lg prose-primary max-w-none animate-fade-in stagger-2">
        <slot />
      </div>
      
      <!-- Updated notice -->
      {updatedDate && (
        <p class="mt-12 pt-8 border-t border-primary-200 text-sm text-primary-500 italic">
          Last updated on {updatedDate.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          })}
        </p>
      )}
      
      <!-- Back to blog -->
      <div class="mt-12 pt-8 border-t border-primary-200">
        <a href="/blog" class="link-underline text-primary-600 hover:text-primary-900">
          ← Back to all posts
        </a>
      </div>
    </div>
  </article>
</BaseLayout>

<style>
  .prose h2 {
    @apply text-2xl md:text-3xl mt-12 mb-4;
  }
  
  .prose h3 {
    @apply text-xl md:text-2xl mt-8 mb-3;
  }
  
  .prose p {
    @apply mb-6 text-primary-700;
  }
  
  .prose a {
    @apply text-accent-600 hover:text-accent-700 underline decoration-accent-300 underline-offset-2;
  }
  
  .prose blockquote {
    @apply border-l-4 border-accent-400 pl-6 italic text-primary-600 my-8;
  }
  
  .prose code {
    @apply font-mono text-sm bg-primary-100 px-2 py-1 rounded;
  }
  
  .prose pre {
    @apply bg-primary-900 text-primary-100 p-6 rounded-sm overflow-x-auto my-8;
  }
  
  .prose pre code {
    @apply bg-transparent p-0;
  }
  
  .prose ul, .prose ol {
    @apply my-6 pl-6;
  }
  
  .prose li {
    @apply mb-2;
  }
  
  .prose img {
    @apply rounded-sm my-8;
  }
</style>

